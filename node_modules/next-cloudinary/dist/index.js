"use strict";var ve=Object.create;var X=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var r in t)X(e,r,{get:t[r],enumerable:!0})},le=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of be(t))!Me.call(e,o)&&o!==r&&X(e,o,{get:()=>t[o],enumerable:!(i=Le(t,o))||i.enumerable});return e};var h=(e,t,r)=>(r=e!=null?ve(Ne(e)):{},le(t||!e||!e.__esModule?X(r,"default",{value:e,enumerable:!0}):r,e)),De=e=>le(X({},"__esModule",{value:!0}),e);var Be={};We(Be,{CldImage:()=>te,CldOgImage:()=>ne,CldUploadButton:()=>ie,CldUploadWidget:()=>B,CldVideoPlayer:()=>ae,cloudinaryLoader:()=>q,getCldImageUrl:()=>v,getCldOgImageUrl:()=>$,getCldVideoUrl:()=>Te});module.exports=De(Be);var L=h(require("react")),Ce=h(require("next/image")),Ie=require("@cloudinary-util/util"),he=require("@cloudinary-util/url-loader");var pe=h(require("next/package.json"));var se={name:"next-cloudinary",version:"6.10.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.2.0","@cloudinary-util/url-loader":"5.6.0","@cloudinary-util/util":"^3.2.0","@tsconfig/recommended":"^1.0.7"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc",react:"^17 || ^18 || >=19.0.0-beta"}};var ce="A",ue="V",ge=fe(pe.default.version),me=fe(se.version);function fe(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}async function F(e){let{src:t}=e;try{await new Promise((r,i)=>{fetch(t).then(o=>{if(!o.ok){i(o);return}r(o)})})}catch(r){return r.status===423?(await new Promise(i=>setTimeout(()=>i(void 0),200)),await F(e)):!1}return!0}function T(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let r=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,i=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:r,cloudName:t},url:{...e?.url,secureDistribution:i,privateCdn:o}},e)}function z(e){return Object.assign({product:ce,sdkCode:ue,sdkSemver:me,techVersion:ge,feature:""},e)}var ye=require("@cloudinary-util/url-loader");function v(e,t,r){return(0,ye.constructCloudinaryUrl)({options:e,config:T(t),analytics:z(r)})}function q({loaderOptions:e,imageProps:t,cldOptions:r,cldConfig:i={}}){let o={...t,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let a=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*a))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return v(o,i)}var Ve=(0,L.forwardRef)(function(t,r){let i=!1,o=["assetType","config","deliveryType","preserveTransformations","strictTransformations"];he.transformationPlugins.forEach(({props:n})=>{Object.keys(n).forEach(I=>{if(o.includes(I))throw new Error(`Option ${I} already exists!`);o.push(I)})});let a={alt:t.alt,src:t.src};Object.keys(t).filter(n=>typeof n=="string"&&!o.includes(n)).forEach(n=>a[n]=t[n]);let p=Object.keys(a).map(n=>`${n}:${a[n]}`).join(";"),[O,C]=(0,L.useState)(p),d={};if(o.forEach(n=>{let c=t[n];c&&(d[n]=c)}),t.preserveTransformations)try{let n=(0,Ie.getTransformations)(t.src).map(c=>c.join(","));d.rawTransformations=[...n.flat(),...t.rawTransformations||[]]}catch(n){console.warn(`Failed to preserve transformations: ${n.message}`)}let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(a.src=v({...d,width:a.width,height:a.height,src:a.src,format:"default",quality:"default"},t.config));async function w(n){let c=!0;if(i)return;if(i=!0,typeof t.onError=="function"){let _=t.onError(n);typeof _=="boolean"&&_===!1&&(c=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(c=!1);if(c===!1)return;let I=n.target;await F({src:I.src})&&C(`${p};${Date.now()}`)}let N=(0,L.useCallback)(w,[F,p]),u=Ce.default;return"default"in u&&(u=u.default),L.default.createElement(u,{key:O,...a,loader:n=>q({loaderOptions:n,imageProps:a,cldOptions:d,cldConfig:t.config}),onError:N,ref:r})}),te=Ve;var E=h(require("react")),Oe=h(require("next/head"));function $(e){return v({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var ke="summary_large_image",Ge=({excludeTags:e=[],twitterTitle:t,keys:r={},...i})=>{let{alt:o}=i,{width:a=1200,height:p=627}=i;a=typeof a=="string"?parseInt(a):a,p=typeof p=="string"?parseInt(p):p;let O=$({...i,width:a,height:p}),C=$({...i,width:a,height:p,format:i.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r};return E.default.createElement(Oe.default,null,E.default.createElement("meta",{key:d["og:image"],property:"og:image",content:O}),E.default.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:O}),E.default.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${a}`}),E.default.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${p}`}),o&&E.default.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&E.default.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),E.default.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:ke}),E.default.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:C}))},ne=Ge;var Y=h(require("react"));var m=h(require("react")),Ee=h(require("next/script")),b=require("@cloudinary-util/url-loader");function Ue(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Re=({children:e,config:t,onError:r,onOpen:i,onUpload:o,options:a,signatureEndpoint:p,uploadPreset:O,...C})=>{let d=(0,m.useRef)(),s=(0,m.useRef)(),[w,N]=(0,m.useState)(void 0),[u,n]=(0,m.useState)(void 0),[c,I]=(0,m.useState)(!0),A=T(t),_=p&&(0,b.generateSignatureCallback)({signatureEndpoint:String(p),fetch}),x=(0,b.getUploadWidgetOptions)({uploadPreset:O||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:_,...a},A),P=(0,b.generateUploadWidgetResultCallback)({onError:l=>{N(l),typeof r=="function"&&r(l,{widget:s.current,...G})},onResult:l=>{if(typeof l?.event!="string")return;n(l);let U=b.UPLOAD_WIDGET_EVENTS[l.event];if(typeof U=="string"&&typeof C[U]=="function"){let j=C[U];j(l,{widget:s.current,...G})}let R=`${U}Action`;if(R&&typeof C[R]=="function"){let j=C[R];j(l)}}});(0,m.useEffect)(()=>{if(typeof u>"u")return;u.event==="success"&&typeof o=="function"&&(process.env.NODE_ENVIRONMENT==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(u,s.current))},[u]);function M(){I(!1),d.current||(d.current=window.cloudinary),Ue(()=>{s.current||(s.current=H())})}(0,m.useEffect)(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function y(l,U=[]){if(s.current||(s.current=H()),typeof s?.current[l]=="function")return s.current[l](...U)}function W(l){y("close",[l])}function S(l){return y("destroy",[l])}function V(){y("hide")}function k(){return y("isDestroyed")}function g(){return y("isMinimized")}function D(){return y("isShowing")}function Q(){y("minimize")}function J(l,U){y("open",[l,U]),typeof i=="function"&&i(s.current)}function Z(){y("show")}function ee(){y("update")}let G={close:W,destroy:S,hide:V,isDestroyed:k,isMinimized:g,isShowing:D,minimize:Q,open:J,show:Z,update:ee};function H(){return d.current?.createUploadWidget(x,P)}return m.default.createElement(m.default.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:s.current,results:u,error:w,isLoading:c,...G}),m.default.createElement(Ee.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:M,onError:l=>console.error(`Failed to load Cloudinary Upload Widget: ${l.message}`)}))},B=Re;var je=({className:e,children:t,onClick:r,onError:i,onOpen:o,onUpload:a,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:d,onPublicId:s,onQueuesEnd:w,onQueuesStart:N,onRetry:u,onShowCompleted:n,onSourceChanged:c,onSuccess:I,onTags:A,onUploadAdded:_,options:x,signatureEndpoint:P,uploadPreset:M,onAbortAction:y,onBatchCancelledAction:W,onCloseAction:S,onDisplayChangedAction:V,onPublicIdAction:k,onQueuesEndAction:g,onQueuesStartAction:D,onRetryAction:Q,onShowCompletedAction:J,onSourceChangedAction:Z,onSuccessAction:ee,onTagsAction:G,onUploadAddedAction:H,...l})=>Y.default.createElement(Y.default.Fragment,null,Y.default.createElement(B,{onError:i,onOpen:o,onUpload:a,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:d,onPublicId:s,onQueuesEnd:w,onQueuesStart:N,onRetry:u,onShowCompleted:n,onSourceChanged:c,onSuccess:I,onTags:A,onUploadAdded:_,options:x,signatureEndpoint:P,uploadPreset:M,onAbortAction:y,onBatchCancelledAction:W,onCloseAction:S,onDisplayChangedAction:V,onPublicIdAction:k,onQueuesEndAction:g,onQueuesStartAction:D,onRetryAction:Q,onShowCompletedAction:J,onSourceChangedAction:Z,onSuccessAction:ee,onTagsAction:G,onUploadAddedAction:H},({open:U,isLoading:R})=>{function j(de){de.preventDefault(),U(),typeof r=="function"&&r(de)}return Y.default.createElement("button",{...l,className:e||"",onClick:j,disabled:R},t||"Upload")})),ie=je;var f=h(require("react")),we=h(require("next/script")),Ae=h(require("next/head")),_e=require("@cloudinary-util/url-loader");var K=[],Pe="1.11.1",$e=e=>{let{className:t,config:r,height:i,id:o,onDataLoad:a,onError:p,onMetadataLoad:O,onPause:C,onPlay:d,onEnded:s,width:w}=e,N=T(r),u=(0,_e.getVideoPlayerOptions)(e,N),{publicId:n}=u;if(typeof n>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let c=(0,f.useRef)(),I=(0,f.useRef)(),A=e.videoRef||I,_=(0,f.useRef)(),x=e.playerRef||_,P=o||`player-${n.replace("/","-")}`,M="cld-video-player cld-fluid";t&&(M=`${M} ${t}`),K.filter(g=>g===P).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):K.push(P);let W={error:p,loadeddata:a,loadedmetadata:O,pause:C,play:d,ended:s};function S(g){let D=W[g.type];typeof D=="function"&&D(k())}function V(){"cloudinary"in window&&(c.current=window.cloudinary,x.current=c.current.videoPlayer(A.current,u),Object.keys(W).forEach(g=>{typeof W[g]=="function"&&x.current?.on(g,S)}))}(0,f.useEffect)(()=>()=>{x.current?.videojs.cloudinary.dispose(),K=K.filter(g=>g!==P)},[]);function k(){return{player:x.current,video:A.current}}return f.default.createElement(f.default.Fragment,null,f.default.createElement(Ae.default,null,f.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Pe}/dist/cld-video-player.min.css`,rel:"stylesheet"})),f.default.createElement("div",{style:{width:"100%",aspectRatio:`${w} / ${i}`}},f.default.createElement("video",{ref:A,id:P,className:M,width:w,height:i}),f.default.createElement(we.default,{id:`cloudinary-videoplayer-${P}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${Pe}/dist/cld-video-player.min.js`,onLoad:V,onError:g=>console.error(`Failed to load Cloudinary Video Player: ${g.message}`)})))},ae=$e;var xe=require("@cloudinary-util/url-loader");function Te(e,t,r){return(0,xe.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:T(t),analytics:z(r)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map