import he,{useState as Oe,useCallback as Ue,forwardRef as Ee}from"react";import Pe from"next/image";import{getTransformations as we}from"@cloudinary-util/util";import{transformationPlugins as Ae}from"@cloudinary-util/url-loader";import Ce from"next/package.json";var oe={name:"next-cloudinary",version:"6.10.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.2.0","@cloudinary-util/url-loader":"5.6.0","@cloudinary-util/util":"^3.2.0","@tsconfig/recommended":"^1.0.7"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc",react:"^17 || ^18 || >=19.0.0-beta"}};var re="A",ne="V",ie=de(Ce.version),ae=de(oe.version);function de(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}async function G(e){let{src:t}=e;try{await new Promise((a,i)=>{fetch(t).then(o=>{if(!o.ok){i(o);return}a(o)})})}catch(a){return a.status===423?(await new Promise(i=>setTimeout(()=>i(void 0),200)),await G(e)):!1}return!0}function A(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let a=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,i=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:a,cloudName:t},url:{...e?.url,secureDistribution:i,privateCdn:o}},e)}function R(e){return Object.assign({product:re,sdkCode:ne,sdkSemver:ae,techVersion:ie,feature:""},e)}import{constructCloudinaryUrl as Ie}from"@cloudinary-util/url-loader";function v(e,t,a){return Ie({options:e,config:A(t),analytics:R(a)})}function q({loaderOptions:e,imageProps:t,cldOptions:a,cldConfig:i={}}){let o={...t,...a};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let n=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*n))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return v(o,i)}var _e=Ee(function(t,a){let i=!1,o=["assetType","config","deliveryType","preserveTransformations","strictTransformations"];Ae.forEach(({props:r})=>{Object.keys(r).forEach(y=>{if(o.includes(y))throw new Error(`Option ${y} already exists!`);o.push(y)})});let n={alt:t.alt,src:t.src};Object.keys(t).filter(r=>typeof r=="string"&&!o.includes(r)).forEach(r=>n[r]=t[r]);let p=Object.keys(n).map(r=>`${r}:${n[r]}`).join(";"),[C,f]=Oe(p),d={};if(o.forEach(r=>{let c=t[r];c&&(d[r]=c)}),t.preserveTransformations)try{let r=we(t.src).map(c=>c.join(","));d.rawTransformations=[...r.flat(),...t.rawTransformations||[]]}catch(r){console.warn(`Failed to preserve transformations: ${r.message}`)}let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(n.src=v({...d,width:n.width,height:n.height,src:n.src,format:"default",quality:"default"},t.config));async function U(r){let c=!0;if(i)return;if(i=!0,typeof t.onError=="function"){let P=t.onError(r);typeof P=="boolean"&&P===!1&&(c=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(c=!1);if(c===!1)return;let y=r.target;await G({src:y.src})&&f(`${p};${Date.now()}`)}let _=Ue(U,[G,p]),u=Pe;return"default"in u&&(u=u.default),he.createElement(u,{key:C,...n,loader:r=>q({loaderOptions:r,imageProps:n,cldOptions:d,cldConfig:t.config}),onError:_,ref:a})}),le=_e;import O from"react";import xe from"next/head";function j(e){return v({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Te="summary_large_image",ve=({excludeTags:e=[],twitterTitle:t,keys:a={},...i})=>{let{alt:o}=i,{width:n=1200,height:p=627}=i;n=typeof n=="string"?parseInt(n):n,p=typeof p=="string"?parseInt(p):p;let C=j({...i,width:n,height:p}),f=j({...i,width:n,height:p,format:i.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...a};return O.createElement(xe,null,O.createElement("meta",{key:d["og:image"],property:"og:image",content:C}),O.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:C}),O.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${n}`}),O.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${p}`}),o&&O.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&O.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),O.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:Te}),O.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:f}))},se=ve;import B from"react";import J,{useState as Z,useEffect as ce,useRef as ue}from"react";import Le from"next/script";import{generateSignatureCallback as be,generateUploadWidgetResultCallback as Ne,getUploadWidgetOptions as Me,UPLOAD_WIDGET_EVENTS as We}from"@cloudinary-util/url-loader";function pe(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var De=({children:e,config:t,onError:a,onOpen:i,onUpload:o,options:n,signatureEndpoint:p,uploadPreset:C,...f})=>{let d=ue(),s=ue(),[U,_]=Z(void 0),[u,r]=Z(void 0),[c,y]=Z(!0),E=A(t),P=p&&be({signatureEndpoint:String(p),fetch}),w=Me({uploadPreset:C||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:P,...n},E),h=Ne({onError:l=>{_(l),typeof a=="function"&&a(l,{widget:s.current,...D})},onResult:l=>{if(typeof l?.event!="string")return;r(l);let I=We[l.event];if(typeof I=="string"&&typeof f[I]=="function"){let V=f[I];V(l,{widget:s.current,...D})}let S=`${I}Action`;if(S&&typeof f[S]=="function"){let V=f[S];V(l)}}});ce(()=>{if(typeof u>"u")return;u.event==="success"&&typeof o=="function"&&(process.env.NODE_ENVIRONMENT==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(u,s.current))},[u]);function x(){y(!1),d.current||(d.current=window.cloudinary),pe(()=>{s.current||(s.current=k())})}ce(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function m(l,I=[]){if(s.current||(s.current=k()),typeof s?.current[l]=="function")return s.current[l](...I)}function T(l){m("close",[l])}function N(l){return m("destroy",[l])}function M(){m("hide")}function W(){return m("isDestroyed")}function g(){return m("isMinimized")}function b(){return m("isShowing")}function H(){m("minimize")}function X(l,I){m("open",[l,I]),typeof i=="function"&&i(s.current)}function F(){m("show")}function z(){m("update")}let D={close:T,destroy:N,hide:M,isDestroyed:W,isMinimized:g,isShowing:b,minimize:H,open:X,show:F,update:z};function k(){return d.current?.createUploadWidget(w,h)}return J.createElement(J.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:s.current,results:u,error:U,isLoading:c,...D}),J.createElement(Le,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:x,onError:l=>console.error(`Failed to load Cloudinary Upload Widget: ${l.message}`)}))},$=De;var Se=({className:e,children:t,onClick:a,onError:i,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:C,onClose:f,onDisplayChanged:d,onPublicId:s,onQueuesEnd:U,onQueuesStart:_,onRetry:u,onShowCompleted:r,onSourceChanged:c,onSuccess:y,onTags:E,onUploadAdded:P,options:w,signatureEndpoint:h,uploadPreset:x,onAbortAction:m,onBatchCancelledAction:T,onCloseAction:N,onDisplayChangedAction:M,onPublicIdAction:W,onQueuesEndAction:g,onQueuesStartAction:b,onRetryAction:H,onShowCompletedAction:X,onSourceChangedAction:F,onSuccessAction:z,onTagsAction:D,onUploadAddedAction:k,...l})=>B.createElement(B.Fragment,null,B.createElement($,{onError:i,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:C,onClose:f,onDisplayChanged:d,onPublicId:s,onQueuesEnd:U,onQueuesStart:_,onRetry:u,onShowCompleted:r,onSourceChanged:c,onSuccess:y,onTags:E,onUploadAdded:P,options:w,signatureEndpoint:h,uploadPreset:x,onAbortAction:m,onBatchCancelledAction:T,onCloseAction:N,onDisplayChangedAction:M,onPublicIdAction:W,onQueuesEndAction:g,onQueuesStartAction:b,onRetryAction:H,onShowCompletedAction:X,onSourceChangedAction:F,onSuccessAction:z,onTagsAction:D,onUploadAddedAction:k},({open:I,isLoading:S})=>{function V(te){te.preventDefault(),I(),typeof a=="function"&&a(te)}return B.createElement("button",{...l,className:e||"",onClick:V,disabled:S},t||"Upload")})),ge=Se;import L,{useRef as ee,useEffect as Ve}from"react";import ke from"next/script";import Ge from"next/head";import{getVideoPlayerOptions as Re}from"@cloudinary-util/url-loader";var Y=[],me="1.11.1",je=e=>{let{className:t,config:a,height:i,id:o,onDataLoad:n,onError:p,onMetadataLoad:C,onPause:f,onPlay:d,onEnded:s,width:U}=e,_=A(a),u=Re(e,_),{publicId:r}=u;if(typeof r>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let c=ee(),y=ee(),E=e.videoRef||y,P=ee(),w=e.playerRef||P,h=o||`player-${r.replace("/","-")}`,x="cld-video-player cld-fluid";t&&(x=`${x} ${t}`),Y.filter(g=>g===h).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):Y.push(h);let T={error:p,loadeddata:n,loadedmetadata:C,pause:f,play:d,ended:s};function N(g){let b=T[g.type];typeof b=="function"&&b(W())}function M(){"cloudinary"in window&&(c.current=window.cloudinary,w.current=c.current.videoPlayer(E.current,u),Object.keys(T).forEach(g=>{typeof T[g]=="function"&&w.current?.on(g,N)}))}Ve(()=>()=>{w.current?.videojs.cloudinary.dispose(),Y=Y.filter(g=>g!==h)},[]);function W(){return{player:w.current,video:E.current}}return L.createElement(L.Fragment,null,L.createElement(Ge,null,L.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${me}/dist/cld-video-player.min.css`,rel:"stylesheet"})),L.createElement("div",{style:{width:"100%",aspectRatio:`${U} / ${i}`}},L.createElement("video",{ref:E,id:h,className:x,width:U,height:i}),L.createElement(ke,{id:`cloudinary-videoplayer-${h}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${me}/dist/cld-video-player.min.js`,onLoad:M,onError:g=>console.error(`Failed to load Cloudinary Video Player: ${g.message}`)})))},fe=je;import{constructCloudinaryUrl as $e}from"@cloudinary-util/url-loader";function Be(e,t,a){return $e({options:{assetType:"video",format:"auto:video",...e},config:A(t),analytics:R(a)})}export{le as CldImage,se as CldOgImage,ge as CldUploadButton,$ as CldUploadWidget,fe as CldVideoPlayer,q as cloudinaryLoader,v as getCldImageUrl,j as getCldOgImageUrl,Be as getCldVideoUrl};
//# sourceMappingURL=index.mjs.map